# Настройка интеграций формы обратной связи

В этом документе описаны шаги для настройки интеграций с email и Telegram для формы обратной связи.

## Переменные окружения

Для работы формы необходимо настроить следующие переменные окружения в файле `.env.local`:

```env
# API ключ для отправки email через Resend
RESEND_API_KEY=your_resend_api_key_here

# Токен Telegram бота
TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here

# ID чата Telegram для отправки сообщений
TELEGRAM_CHAT_ID=your_telegram_chat_id_here
```

> **Важно:** Файл `.env.local` автоматически добавлен в `.gitignore` и не будет отправлен в репозиторий, что обеспечивает безопасность ваших учетных данных.

## Настройка Resend (для email)

1. Зарегистрируйтесь на [Resend.com](https://resend.com)
2. Создайте API ключ в разделе "API Keys"
3. Укажите домен для отправки email
4. Добавьте API ключ в переменные окружения как `RESEND_API_KEY`

## Настройка Telegram бота

1. Найдите в Telegram бота @BotFather
2. Создайте нового бота с помощью команды `/newbot`
3. Следуйте инструкциям и получите токен бота
4. Чтобы получить ID чата для отправки сообщений, есть несколько способов:

   ### Способ 1 (для личных сообщений):
   - Отправьте любое сообщение боту
   - Перейдите по ссылке: `https://api.telegram.org/bot<TOKEN>/getUpdates`
   - Найдите `chat.id` в JSON-ответе

   ### Способ 2 (с использованием BotFather):
   - Используйте команду `/mybots` в @BotFather
   - Выберите вашего бота
   - Нажмите "Edit Bot" → "Bot Settings" → "Allow Groups"
   - Добавьте бота в группу или используйте его в личных сообщениях

   ### Способ 3 (с помощью сторонних сервисов):
   - Найдите в Telegram бота @userinfobot
   - Отправьте ему команду `/start`
   - Он покажет ваш ID пользователя

5. Добавьте токен и ID чата в переменные окружения

## Альтернативные способы отправки email

Если вы хотите использовать другой сервис для отправки email, вы можете модифицировать функцию `sendEmail` в файле `api/lead.js`:

- [Nodemailer](https://nodemailer.com/) для SMTP
- [SendGrid](https://sendgrid.com/) API
- [Mailgun](https://www.mailgun.com/) API
- [AWS SES](https://aws.amazon.com/ru/ses/) для Amazon Web Services

## Тестирование формы

После настройки всех переменных окружения вы можете протестировать форму:

1. Запустите локальный сервер: `npm run dev`
2. Откройте сайт в браузере
3. Заполните форму и отправьте
4. Проверьте, что получили email и сообщение в Telegram

## Обработка ошибок

Форма реализована с устойчивостью к сбоям:

- Если один из способов доставки (email или Telegram) не работает, другая доставка все равно будет выполнена
- При сбое показывается пользователю соответствующее сообщение об ошибке
- Все ошибки логируются на сервере для диагностики

## Безопасность

- Все API ключи должны храниться в переменных окружения
- Не коммитьте файл `.env.local` в репозиторий
- Убедитесь, что настроена валидация и очистка данных на сервере

## Настройка на продакшене

При деплое на Vercel или другой платформе, убедитесь, что вы добавили следующие переменные окружения:

- `RESEND_API_KEY`
- `TELEGRAM_BOT_TOKEN`
- `TELEGRAM_CHAT_ID`

Это можно сделать в настройках проекта на Vercel в разделе Environment Variables.